<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <h1>formulario teste</h1>
  <input type="text" placeholder="nome produto" id="nome">
  <input type="text" placeholder="url img" id="img">
  <input type="text" placeholder="preço" id="preço">
  <input type="number" placeholder="polegadas" id="polegadas">
  <input type="text" placeholder="cor" id="cor">
  <input type="number" placeholder="nota" id="nota">
  <input type="button" value="Cadastrar" onclick="cadastrar()">
  <br>
  <br>
  <input type="button" value="Ver Produtos" onclick="ver()">
  <ul id="tabela"></ul>
  <br>
  <br>
  <input type="text" placeholder="Id" id="id_product">
  <input type="button" value="Ver Produtos" onclick="verUm()">
  <ul id="tabelaDeUm"></ul>
  
  <script>
    function cadastrar() {
      const nome = document.getElementById('nome');
      const img = document.getElementById('img');
      const preco = document.getElementById('preço');
      const polegadas = document.getElementById('polegadas');
      const cor = document.getElementById('cor');
      const nota = document.getElementById('nota');

      const update = {
        name: nome.value,
        img: img.value,
        price: preco.value,
        description: {
          polegadas: polegadas.value,
          cor: cor.value,
          nota: nota.value
        }
      };

      const options = {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(update),
      };

      fetch(`https://api-node-teste.herokuapp.com/product`, options)
        .then(data => {
          if (!data.ok) {
            throw Error(data.status);
          }
          return data.json();
        })
        .then(update => { console.log(update); })
        .catch(e => { console.log(e); });
    }

    function ver() {
      fetch(`https://api-node-teste.herokuapp.com/product`)
        .then((response) => { return response.json() })
        .then((data) => {
          const ul = document.querySelector('#tabela')
          ul.innerHTML = "";
          
          data.data.forEach((item) => {
            let properties = '';
            Object.entries(item.description).forEach(([key, value])=>{
              //na linha abaixo as propriedades e valores são passados. Buscar meios mais interessantes de fazer isso.
              properties += `${key}: ${value} <br>`;
            });
            console.log(properties)
            ul.innerHTML += `
                    <div class="mostraProdutos">
                        <ul class="mostra">
                            <li>Id: ${item._id}</li>
                            <li>Nome: ${item.name}</li>
                            <li>Imagem: <img src="${item.img}" alt=""></li>
                            <li>Preço: ${item.price}</li>
                            <li>Informações: 
                              ${properties}</li>
                        </ul>
                        <br>
                    </div>`
          })
        })
        .catch(e => { console.log(e); });
    }

    function verUm() {
      const id_product = document.getElementById('id_product').value;

      fetch(`https://api-node-teste.herokuapp.com/product/${id_product}`)
        .then((response) => { return response.json() })
        .then((data) => {
          const ul = document.querySelector('#tabelaDeUm')
          ul.innerHTML = "";

            let properties = '';
            Object.entries(data.data.description).forEach(([key, value])=>{
              properties += `${key}: ${value} <br>`;
            });
            console.log(properties)
          ul.innerHTML += `
                    <div class="mostraProduto">
                        <ul class="mostra">
                            <li>Id: ${data.data._id}</li>
                            <li>Nome: ${data.data.name}</li>
                            <li>Imagem: <img src="${data.data.img}"></li>
                            <li>Preço: ${data.data.price}</li>
                            <li>Data de Coleta: ${properties}</li>
                        </ul>
                    </div>`
        })
        .catch(e => { console.log(e); });
    }

  </script>
</body>

</html>